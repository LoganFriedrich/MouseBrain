training a cellfinder network


Import a brain and a background layer into napari.

Open the cellfinder (curation) plugin.

Open file explorer and create a new folder (directory) for the trained network within the brainglobe folder on the confocal shared/brainglobe/trained models folder - I used the date

Load signal and background images into the "load data" window 

Click "Add training data layers"

Adjust opacity and place the signal channel and cells/noncells layers above the background layers on the interface on the left so that cells can be seen.

In the cells and noncells layers, adjust the color settings so that the face color is #00000000 and the boarder colors differ between the cell and noncell

Set the point size to 4

Select a slice layer with cells

Click the plus icon on the cells layer (upper left of interface) (or press "p") and begin clicking on the center of cells (make sure that the active layer is the cell layer)

Once you have a bunch of cells labeled, repeat this process on the noncell layer clicking instead on non cells and things that look like they might confuse the network, make sure to include background areas with no cells and no confusing areas

When done with one slice, activate the cells layer, hightlight all cells using the select points tool (or press "s"), and click the "mark as cells" button on the right.

Repeat this with the noncells in the noncell layer and the "mark as noncells" button.

Repeat the cells and noncells process for a bunch of layers.

When ready, click on "save training data" and direct to the directory that you created previously.

When complete, open cellfinder (train network) plugin.

The yaml (.yml) file is in the directory you just saved to.

The output directory is the same directory as well.

The trained model is either default or you can choose an old model which should be in the confocal shared/brainglobe/trained models folder as well.

Everything else can be left as default or to increase weightedness to the current cells/noncells that you added, you can increase the "Epochs" option. I used 150.

Click run and wait. 150 Epochs took 8.5 hours.

To use this model to analyze, select it from the directory when running cellfinder.